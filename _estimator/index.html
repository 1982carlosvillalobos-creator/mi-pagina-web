<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="robots" content="noindex,nofollow" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Golden Charge - Estimador Profesional v7.0</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <style>
    :root {
      --gold: #FFD700; --dark-blue: #0A2463; --light-gray: #f8f9fa;
      --text: #1e1e1e; --card-bg: #ffffff; --border: #ddd;
      --btn-bg: var(--dark-blue); --btn-text: var(--gold);
      --btn-hover: #FFC700; --btn-hover-text: var(--dark-blue);
      --shadow: 0 5px 20px rgba(0,0,0,.1); --radius: 12px;
    }
    * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }
    body { background: var(--light-gray); color: var(--text); line-height: 1.6; padding: 20px; }
    .container { max-width: 1000px; margin: 0 auto; padding: 20px; }
    .header { text-align: center; margin-bottom: 30px; }
    .header img { height: 80px; width: 80px; border-radius: 50%; border: 3px solid var(--gold); margin-bottom: 10px; }
    h1, h2, h3 { color: var(--dark-blue); }
    h1 { font-size: 1.8rem; font-weight: 700; }
    .subtitle { color: var(--dark-blue); font-size: 1.1rem; opacity: 0.8; }
    .login { text-align: center; margin: 80px 0; }
    .login input { padding: 12px 16px; font-size: 1.2rem; border: 2px solid var(--border); border-radius: 8px; width: 280px; margin-right: 10px; }
    .login button { padding: 12px 20px; background: var(--btn-bg); color: var(--btn-text); border: none; border-radius: 8px; cursor: pointer; font-weight: bold; font-size: 1.1rem; }
    .app { display: none; background: var(--card-bg); padding: 25px; border-radius: var(--radius); box-shadow: var(--shadow); }
    .section { background: #fff; padding: 20px; border-radius: var(--radius); margin-bottom: 20px; box-shadow: 0 2px 10px rgba(0,0,0,.05); border: 1px solid var(--border); }
    .section-title { font-size: 1.2rem; margin-bottom: 15px; font-weight: 600; display: flex; align-items: center; gap: 10px; }
    .section-title i { color: var(--gold); }
    .form-group { margin-bottom: 15px; }
    .form-group label { display: block; margin-bottom: 8px; font-weight: 600; color: var(--dark-blue); font-size: 0.95rem; }
    .form-control, .btn { width: 100%; padding: 10px 12px; border: 1px solid var(--border); border-radius: 8px; font-size: 0.95rem; }
    .controls { display: flex; align-items: center; gap: 10px; margin: 8px 0; }
    .controls button { background: var(--dark-blue); color: white; border: none; width: 35px; height: 35px; border-radius: 50%; font-size: 1.1rem; cursor: pointer; }
    .controls span { font-size: 1.1rem; font-weight: bold; }
    table { width: 100%; border-collapse: collapse; margin: 15px 0; font-size: 0.9rem; }
    th, td { padding: 10px; text-align: left; border: 1px solid var(--border); }
    th { background: var(--dark-blue); color: var(--gold); }
    .total-row { font-weight: bold; background: #f0f0f0; }
    .btn { background: var(--btn-bg); color: var(--btn-text); border-radius: 50px; cursor: pointer; font-weight: bold; margin-top: 10px; transition: 0.3s; }
    .btn:disabled { background-color: #ccc; cursor: not-allowed; transform: none; box-shadow: none; }
    .btn:hover:not(:disabled) { transform: translateY(-2px); box-shadow: 0 4px 10px rgba(0,0,0,.2); }
    .btn-pdf { background: #007BFF; color: white; }
    .search-container { position: relative; }
    .search-results { position: absolute; top: 100%; left: 0; right: 0; max-height: 300px; overflow-y: auto; background: white; border: 1px solid var(--border); border-radius: 8px; margin-top: 5px; z-index: 10; box-shadow: 0 5px 15px rgba(0,0,0,.1); }
    .material-item { display: flex; align-items: center; gap: 10px; padding: 8px; background: #f9f9f9; cursor: pointer; transition: background 0.2s; border-bottom: 1px solid #eee; }
    .material-item:hover { background: #f0f0f0; }
    .material-name { flex: 1; font-weight: 500; }
    .material-price { color: var(--dark-blue); font-weight: bold; min-width: 80px; text-align: right; }
    .slider-label-group { display: flex; justify-content: space-between; font-size: 0.85rem; color: #666; }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <img src="https://pub-a9f35b2b86db4656b16e6e97d0d62544.r2.dev/logo.png" alt="Golden Charge Logo">
      <h1>üîß Estimador Profesional</h1>
      <p class="subtitle">Golden Charge Electrician Company</p>
    </div>

    <div id="login" class="login">
      <input type="password" id="password" placeholder="Contrase√±a" />
      <button onclick="checkPassword()">Entrar</button>
    </div>

    <div id="app" class="app">
      <form id="quoteForm">
        <div class="section">
          <h3 class="section-title"><i class="fas fa-file-alt"></i> Datos del Cliente y Proyecto</h3>
          <div class="form-group">
            <label for="clientName">Nombre del Cliente:</label>
            <input type="text" id="clientName" class="form-control" placeholder="Ej: John Smith">
          </div>
          <div class="form-group">
            <label for="clientAddress">Direcci√≥n del Proyecto:</label>
            <input type="text" id="clientAddress" class="form-control" placeholder="Ej: 123 Main St">
          </div>
          <div class="form-group">
            <label for="city">Ciudad del Proyecto:</label>
            <select id="city" class="form-control">
              <option value="Fremont">Fremont</option>
              <option value="San Francisco">San Francisco</option>
              <option value="Oakland">Oakland</option>
              <option value="San Jose">San Jose</option>
              <option value="Hayward">Hayward</option>
              <option value="Berkeley">Berkeley</option>
              <option value="Richmond">Richmond</option>
              <option value="Sunnyvale">Sunnyvale</option>
              <option value="Palo Alto">Palo Alto</option>
              <option value="Concord">Concord</option>
              <option value="Daly City">Daly City</option>
              <option value="San Mateo">San Mateo</option>
              <option value="Walnut Creek">Walnut Creek</option>
            </select>
          </div>
          <div class="form-group">
            <label for="projectType">Tipo de Proyecto:</label>
            <select id="projectType" class="form-control">
              <option value="service-call">Llamada de Servicio / Diagn√≥stico</option>
              <option value="panel">Upgrade de Panel Principal (100A-200A)</option>
              <option value="rewire-full-house">Recableado Completo de Casa (Rewire)</option>
              <option value="ev">Instalaci√≥n de Cargador EV (Nivel 2, 50A)</option>
              <option value="new">Instalaci√≥n de Luces Empotradas (Recessed)</option>
              <option value="subpanel-install">Instalaci√≥n de Subpanel (Garaje/Taller)</option>
              <option value="kitchen-remodel">Remodelaci√≥n El√©ctrica de Cocina</option>
              <option value="bathroom-remodel">Remodelaci√≥n El√©ctrica de Ba√±o</option>
              <option value="new">Instalar/Mover Enchufes e Interruptores</option>
              <option value="landscape-lighting">Iluminaci√≥n de Jard√≠n (Landscape)</option>
              <option value="commercial-tio">Mejoras para Inquilinos Comerciales (T.I.)</option>
              <option value="low-voltage">Instalaci√≥n de Bajo Voltaje (Datos/Ethernet)</option>
            </select>
          </div>
        </div>

        <div class="section">
          <h3 class="section-title"><i class="fas fa-users-cog"></i> Equipo y Tarifas por Hora</h3>
          <div class="form-group">
            <label for="contractorRate">Tu Tarifa por Hora (Contratista C-10): $<output id="contractorRateValue">0</output>/hr</label>
            <input type="range" id="contractorRate" class="form-control">
            <div class="slider-label-group">
                <span id="contractorRateMin">$0</span><span id="contractorRateMax">$0</span>
            </div>
          </div>
          <hr style="margin: 20px 0;">
          <div class="form-group">
            <label>N√∫mero de Ayudantes:</label>
            <div class="controls">
              <button type="button" onclick="removeHelper()">‚àí</button><span id="helperCount">1</span><button type="button" onclick="addHelper()">+</button>
            </div>
          </div>
          <div class="form-group" id="helperRateSection">
            <label for="helperRate">Tarifa por Hora (Ayudante): $<output id="helperRateValue">0</output>/hr</label>
            <input type="range" id="helperRate" class="form-control">
            <div class="slider-label-group">
                <span id="helperRateMin">$0</span><span id="helperRateMax">$0</span>
            </div>
          </div>
          <hr style="margin: 20px 0;">
          <div class="form-group">
            <label>D√≠as estimados de trabajo:</label>
            <input type="number" id="days" value="1" min="0.5" step="0.5" class="form-control" />
            <small>Cada d√≠a completo = 8 horas.</small>
          </div>
        </div>

        <div class="section">
          <h3 class="section-title"><i class="fas fa-sliders-h"></i> Cliente y Ajustes de Precio</h3>
          <div class="form-group">
            <label>Tipo de Cliente:</label>
            <select id="clientType" class="form-control">
              <option value="homeowner">Cliente Final</option>
              <option value="contractor">Contratista General</option>
            </select>
          </div>
          <div class="form-group" id="contractorDiscountSection" style="display:none;">
            <label>Descuento para Contratista: <output id="contractorDiscountValue">15</output>%</label>
            <input type="range" id="contractorDiscount" min="10" max="30" value="15" class="form-control">
             <div class="slider-label-group"><span>10%</span><span>30%</span></div>
          </div>
          <div class="form-group">
            <label>Markup de Materiales: <output id="markupValue">30</output>%</label>
            <input type="range" id="materialMarkup" min="25" max="55" value="30" class="form-control">
            <div class="slider-label-group"><span>25% (M√≠n.)</span><span>55% (M√°x.)</span></div>
          </div>
        </div>

        <div class="section">
          <h3 class="section-title"><i class="fas fa-box"></i> Materiales</h3>
          <div class="form-group">
            <label>B√∫squeda de Materiales:</label>
            <div class="search-container">
              <input type="text" id="materialSearch" class="form-control" placeholder="Ej: romex, outlet, breaker...">
              <div id="searchResults" class="search-results" style="display:none;"></div>
            </div>
          </div>
          <div class="form-group">
            <label>Materiales Seleccionados:</label>
            <div id="selectedMaterialsList"><p style="color:#888;text-align:center;padding:10px;">Ning√∫n material seleccionado</p></div>
          </div>
        </div>

        <div style="text-align:center;margin:30px 0;">
          <button type="button" class="btn" onclick="calculateQuote()">üìä Calcular Cotizaci√≥n</button>
          <button type="button" class="btn btn-pdf" id="exportPdfBtn" onclick="generatePDF()" disabled>üìÑ Exportar a PDF</button>
        </div>
      </form>
      <div id="results"></div>
    </div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
  <script>
    // --- GLOBAL VARIABLES ---
    let helperCount = 1;
    let allMaterials = [];
    let selectedMaterials = [];
    let laborRates = {};
    let permits = {};
    const salesTaxRates = {
        "Fremont": 0.1025, "San Francisco": 0.0863, "Oakland": 0.1025,
        "San Jose": 0.0938, "Hayward": 0.1075, "Berkeley": 0.1025,
        "Richmond": 0.0925, "Sunnyvale": 0.0913, "Palo Alto": 0.0913,
        "Concord": 0.0925, "Daly City": 0.0938, "San Mateo": 0.0963, "Walnut Creek": 0.0925
    };

    // --- INITIALIZATION ---
    function checkPassword() {
      if (document.getElementById('password').value === 'GoldenCharge2025!') {
        localStorage.setItem('estimatorAccess', 'true');
        document.getElementById('login').style.display = 'none';
        document.getElementById('app').style.display = 'block';
        initializeApp();
      } else { alert('Contrase√±a incorrecta'); }
    }
    
    document.addEventListener('DOMContentLoaded', () => {
        if (localStorage.getItem('estimatorAccess') === 'true') {
            document.getElementById('login').style.display = 'none';
            document.getElementById('app').style.display = 'block';
            initializeApp();
        }
    });
    
    async function initializeApp() {
        // Load and parse each file individually for better error reporting.
        try {
            const laborRes = await fetch('data/labor_rates.json');
            if (!laborRes.ok) throw new Error(`No se pudo cargar labor_rates.json (Status: ${laborRes.status})`);
            laborRates = await laborRes.json();
        } catch (e) {
            alert("ERROR CR√çTICO: Hay un error de sintaxis en tu archivo 'labor_rates.json'. Revisa si hay comas (,) extra al final de las listas.");
            console.error(e); return;
        }

        try {
            const materialsRes = await fetch('data/materials_prices.json');
            if (!materialsRes.ok) throw new Error(`No se pudo cargar materials_prices.json (Status: ${materialsRes.status})`);
            const prices = await materialsRes.json();
            allMaterials = [];
            for (const category in prices) {
                for (const [itemName, itemPrice] of Object.entries(prices[category])) {
                    allMaterials.push({ id: itemName, name: itemName, price: itemPrice });
                }
            }
        } catch (e) {
            alert("ERROR CR√çTICO: Hay un error de sintaxis en tu archivo 'materials_prices.json'. Revisa si hay comas (,) extra al final de las listas.");
            console.error(e); return;
        }

        try {
            const permitsRes = await fetch('data/permits.json');
            if (!permitsRes.ok) throw new Error(`No se pudo cargar permits.json (Status: ${permitsRes.status})`);
            permits = await permitsRes.json();
        } catch (e) {
            alert("ERROR CR√çTICO: Hay un error de sintaxis en tu archivo 'permits.json'. Revisa si hay comas (,) extra al final de las listas.");
            console.error(e); return;
        }

        if (allMaterials.length === 0) {
            alert("La lista de materiales est√° vac√≠a. Verifica el archivo 'materials_prices.json'.");
            return;
        }
        
        console.log(`‚úÖ ${allMaterials.length} Materiales cargados.`);
        setupEventListeners();
        updateRateSliders(document.getElementById('city').value);
    }

    function setupEventListeners() {
        document.getElementById('city').addEventListener('change', (e) => updateRateSliders(e.target.value));
        document.getElementById('materialSearch').addEventListener('input', handleMaterialSearch);
        document.getElementById('clientType').addEventListener('change', handleClientTypeChange);
        
        ['contractorRate', 'helperRate', 'contractorDiscount', 'materialMarkup'].forEach(id => {
            const slider = document.getElementById(id);
            const output = document.getElementById(id + 'Value');
            if (slider && output) {
                slider.addEventListener('input', () => { output.textContent = slider.value; });
            }
        });

        document.addEventListener('click', (e) => {
            if (!e.target.closest('.search-container')) document.getElementById('searchResults').style.display = 'none';
        });
    }

    // --- UI UPDATE FUNCTIONS ---
    function updateRateSliders(city) {
        if (!laborRates[city]) {
            console.warn(`No se encontraron tarifas para la ciudad: ${city}`);
            return;
        }
        const rates = laborRates[city].labor_rate;

        updateSliderUI('contractorRate', Math.round(rates.contractor_c10 * 0.85), Math.round(rates.contractor_c10 * 1.20), rates.contractor_c10);
        updateSliderUI('helperRate', Math.round(rates.helper * 0.90), Math.round(rates.helper * 1.25), rates.helper);
    }
    
    function updateSliderUI(id, min, max, value) {
        const slider = document.getElementById(id), output = document.getElementById(id + 'Value');
        const minLabel = document.getElementById(id + 'Min'), maxLabel = document.getElementById(id + 'Max');
        if (!slider || !output || !minLabel || !maxLabel) return;
        slider.min = min; slider.max = max; slider.value = value;
        output.textContent = value;
        minLabel.textContent = `$${min}`; maxLabel.textContent = `$${max}`;
    }

    function handleClientTypeChange(e) {
        document.getElementById('contractorDiscountSection').style.display = e.target.value === 'contractor' ? 'block' : 'none';
    }

    function addHelper() {
        if (helperCount < 10) helperCount++;
        document.getElementById('helperCount').textContent = helperCount;
        document.getElementById('helperRateSection').style.display = 'block';
    }
    function removeHelper() {
        if (helperCount > 0) helperCount--;
        document.getElementById('helperCount').textContent = helperCount;
        if(helperCount === 0) document.getElementById('helperRateSection').style.display = 'none';
    }

    // --- MATERIAL HANDLING ---
    function handleMaterialSearch(e) {
        const searchTerm = e.target.value.toLowerCase();
        const resultsContainer = document.getElementById('searchResults');
        if (searchTerm.length < 2) { resultsContainer.style.display = 'none'; return; }
        const filtered = allMaterials.filter(m => m.name.toLowerCase().includes(searchTerm)).slice(0, 50);

        resultsContainer.innerHTML = filtered.length ? filtered.map(material => 
            `<div class="material-item" onclick="addItemToQuote('${material.id}')">
                <div class="material-name">${material.name}</div>
                <div class="material-price">$${material.price.toFixed(2)}</div>
            </div>`
        ).join('') : '<div class="material-item">No se encontraron materiales</div>';
        resultsContainer.style.display = 'block';
    }
    
    function addItemToQuote(materialId) {
        const material = allMaterials.find(m => m.id === materialId);
        if (!material) return;
        const existing = selectedMaterials.find(m => m.id === material.id);
        if (existing) { existing.qty++; } else { selectedMaterials.push({ ...material, qty: 1 }); }
        updateSelectedMaterialsList();
        document.getElementById('materialSearch').value = '';
        document.getElementById('searchResults').style.display = 'none';
    }
    
    function updateSelectedMaterialsList() {
        const container = document.getElementById('selectedMaterialsList');
        if (selectedMaterials.length === 0) { container.innerHTML = '<p style="color:#888;text-align:center;padding:10px;">Ning√∫n material seleccionado</p>'; return; }
        let totalMaterialCost = 0;
        const tableRows = selectedMaterials.map((m, i) => {
            const total = m.qty * m.price;
            totalMaterialCost += total;
            return `<tr><td>${m.name}</td><td><input type="number" class="form-control" value="${m.qty}" min="1" onchange="updateMaterialQty(${i}, this.value)"></td><td>$${m.price.toFixed(2)}</td><td>$${total.toFixed(2)}</td><td><button type="button" class="btn" style="background:#c82333;color:white;padding:5px 10px;" onclick="removeMaterial(${i})">X</button></td></tr>`;
        }).join('');
        container.innerHTML = `<table><thead><tr><th>Material</th><th>Cantidad</th><th>Precio Unitario</th><th>Total</th><th>Acci√≥n</th></tr></thead><tbody>${tableRows}</tbody><tfoot><tr class="total-row"><td colspan="3"><strong>Costo de Materiales (Antes de Markup)</strong></td><td colspan="2"><strong>$${totalMaterialCost.toFixed(2)}</strong></td></tr></tfoot></table>`;
    }

    function updateMaterialQty(index, qty) {
        selectedMaterials[index].qty = Math.max(1, parseFloat(qty) || 1);
        updateSelectedMaterialsList();
    }
    function removeMaterial(index) {
        selectedMaterials.splice(index, 1);
        updateSelectedMaterialsList();
    }
    
    // --- CALCULATION & PDF ---
    function getPermitCost(projectTypeKey, city) {
        const permitKey = projectTypeKey.includes('panel') ? 'panel' : projectTypeKey.includes('ev') ? 'ev' : 'new';
        return permits[city]?.[permitKey] || 220;
    }

    function calculateQuote() {
        const city = document.getElementById('city').value;
        const days = parseFloat(document.getElementById('days').value) || 0;
        const hours = days * 8;
        const contractorRate = parseFloat(document.getElementById('contractorRate').value);
        const helperRate = parseFloat(document.getElementById('helperRate').value);
        const markupPercent = parseFloat(document.getElementById('materialMarkup').value) / 100;
        const clientType = document.getElementById('clientType').value;
        const projectType = document.getElementById('projectType').value;
        
        const permitCost = getPermitCost(projectType, city);
        const taxRate = salesTaxRates[city] || 0.095;

        const contractorLaborSell = hours * contractorRate;
        const helperLaborSell = (helperCount > 0) ? (hours * helperCount * helperRate) : 0;
        const totalLaborSell = contractorLaborSell + helperLaborSell;

        const materialBaseCost = selectedMaterials.reduce((acc, m) => acc + (m.qty * m.price), 0);
        const materialSell = materialBaseCost * (1 + markupPercent);
        const salesTax = materialSell * taxRate;
        
        let subtotal = totalLaborSell + materialSell + salesTax + permitCost;
        let discountAmount = 0;
        if (clientType === 'contractor') {
            const discountPercent = parseFloat(document.getElementById('contractorDiscount').value) / 100;
            discountAmount = subtotal * discountPercent;
        }
        const finalPrice = subtotal - discountAmount;

        displayResult({ city, finalPrice, totalLaborSell, materialSell, salesTax, permitCost, helperCount, discountAmount, clientType });
    }

    function displayResult(data) {
        const results = document.getElementById('results');
        let discountRow = '';
        if (data.clientType === 'contractor') {
            discountRow = `<tr><td>Descuento para Contratista</td><td style="text-align:right; color: red;">-$${data.discountAmount.toFixed(2)}</td></tr>`;
        }

        results.innerHTML = `<div id="quote-result" class="section">
            <h3 class="section-title"><i class="fas fa-file-invoice-dollar"></i> Resumen de la Cotizaci√≥n</h3>
            <table style="width:100%;margin-bottom:20px;">
              <tr><th>Concepto</th><th style="text-align:right;">Precio de Venta</th></tr>
              <tr><td>Mano de Obra (1 Contratista ${data.helperCount > 0 ? `+ ${data.helperCount} Ayudante(s)`: ''})</td><td style="text-align:right;">$${data.totalLaborSell.toFixed(2)}</td></tr>
              <tr><td>Materiales (con markup)</td><td style="text-align:right;">$${data.materialSell.toFixed(2)}</td></tr>
              <tr><td>Impuesto sobre Venta (${(salesTaxRates[data.city]*100).toFixed(2)}%)</td><td style="text-align:right;">$${data.salesTax.toFixed(2)}</td></tr>
              <tr><td>Permisos e Inspecci√≥n (${data.city})</td><td style="text-align:right;">$${data.permitCost.toFixed(2)}</td></tr>
              ${discountRow}
              <tr class="total-row" style="font-size:1.2rem;">
                <td><strong>Precio Final Estimado al Cliente</strong></td><td style="text-align:right;"><strong>$${data.finalPrice.toFixed(2)}</strong></td>
              </tr>
            </table></div>`;
        results.scrollIntoView({ behavior: 'smooth' });
        document.getElementById('exportPdfBtn').disabled = false;
    }
    
    function generatePDF() {
        const quoteResultHtml = document.getElementById('quote-result')?.innerHTML;
        if (!quoteResultHtml) { alert("Primero calcula una cotizaci√≥n."); return; }
        
        const btn = document.getElementById('exportPdfBtn');
        btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Generando...';
        btn.disabled = true;

        const clientName = document.getElementById('clientName').value || 'Cliente Valioso';
        const clientAddress = document.getElementById('clientAddress').value || 'N/A';
        const city = document.getElementById('city').value;
        const projectDesc = document.getElementById('projectType').selectedOptions[0].text;
        const date = new Date().toLocaleDateString('es-MX', { year: 'numeric', month: 'long', day: 'numeric' });

        const pdfContainer = document.createElement('div');
        pdfContainer.style.fontFamily = 'Arial, sans-serif';
        pdfContainer.style.padding = '20px';
        pdfContainer.style.fontSize = '10px';
        
        pdfContainer.innerHTML = `
            <table style="width:100%; margin-bottom: 20px; border: none;">
                <tr style="border: none;"><td style="width: 20%; border: none;"><img src="https://pub-a9f35b2b86db4656b16e6e97d0d62544.r2.dev/logo.png" style="width: 80px;"></td><td style="width: 80%; text-align: right; border: none;"><h2 style="margin:0; color:#0A2463; font-size: 20px;">Golden Charge Electrician Company</h2><p style="margin:0;">(510) 221-1258 | carlos.villalobos@goldencharge.net</p><p style="margin:0;">Licencia # 1143055</p></td></tr>
            </table>
            <hr>
            <h3 style="color:#0A2463; text-align:center; font-size: 16px;">COTIZACI√ìN DE PROYECTO</h3>
            <table style="width:100%; margin: 20px 0; font-size: 10px;">
                <tr><td style="width:50%;"><strong>PARA:</strong><br>${clientName}<br>${clientAddress}, ${city}</td><td style="width:50%; text-align:right;"><strong>FECHA:</strong> ${date}<br><strong>COTIZACI√ìN #:</strong> ${Date.now().toString().slice(-6)}</td></tr>
            </table>
            <p><strong>DESCRIPCI√ìN DEL PROYECTO:</strong> ${projectDesc}</p>
            ${quoteResultHtml}
            <div style="margin-top: 30px; font-size: 9px; position: absolute; bottom: 40px;">
                <p><strong>T√©rminos y Condiciones:</strong></p>
                <ol style="margin-left: 15px; padding-left: 0;">
                    <li>Esta cotizaci√≥n es v√°lida por 30 d√≠as.</li>
                    <li>El pago se realizar√° 50% al aceptar la propuesta para cubrir materiales y 50% al finalizar satisfactoriamente el trabajo.</li>
                    <li>Cualquier trabajo adicional o cambio solicitado no incluido en esta cotizaci√≥n ser√° documentado y facturado por separado.</li>
                </ol>
            </div>`;
        
        html2pdf().from(pdfContainer).set({
            margin: 10, filename: `cotizacion-${clientName.replace(/\s+/g, '-')}.pdf`,
            image: { type: 'jpeg', quality: 1.0 }, html2canvas: { scale: 2, useCORS: true },
            jsPDF: { unit: 'mm', format: 'letter', orientation: 'portrait' }
        }).save().then(() => {
            btn.innerHTML = 'üìÑ Exportar a PDF'; btn.disabled = false;
        }).catch(err => {
            console.error(err); btn.innerHTML = 'üìÑ Exportar a PDF'; btn.disabled = false;
        });
    }
  </script>
</body>
</html>
